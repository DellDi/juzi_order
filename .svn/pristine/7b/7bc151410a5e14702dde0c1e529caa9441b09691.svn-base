Page({
  data: {
    assignseat:null,
    selectseat:null,
    array: ['美国', '中国', '巴西', '日本'],
    objectArray: [{
        id: 0,
        name: '美国'
      },
      {
        id: 1,
        name: '中国'
      },
      {
        id: 2,
        name: '巴西'
      },
      {
        id: 3,
        name: '日本'
      }
    ],

    index: 0,
    multiArray: [
      [],
      [],
      []
    ],
    clockname: '',
    objectMultiArray: [
      [{
          id: 0,

        },
        {
          id: 1,

        },
        {
          id: 3,

        },
        {
          id: 4,

        },
        {
          id: 5,

        },
        {
          id: 6,

        }
      ],
      [{
          id: 0,

        },
        {
          id: 1,
        },
        {
          id: 2,

        },
        {
          id: 3,

        },
        {
          id: 4,

        }
      ],
      [{
          id: 0,

        }

      ]
    ],
    multiIndex: [0, 0, 0],
  },

  onLoad: function(options) {
    
    var that = this;
    console.log(that.data.assignseat);
    if(!that.data.assignseat){
        that.setData({
          assignseat: options.selected,
          selectseat:options.id
        })
    }
    var domain = getApp().globalData.domain;
    wx: wx.request({
      url: domain + 'Appointment/get_appoint_date',
      method: 'GET',
      data: {
        shopid: wx.getStorageSync('shopid')
      },
      header: {
        'Accept': 'application/json'
      },
      success: function(res) {
        that.setData({
          //  multiArray: multiArray,
          shopRes: res.data.shopRes,
          classes: res.data.classes,
          multiArray: res.data.arr,
          array: res.data.tables,
          ids: res.data.ids

        })
        that.data.multiArray = res.data.arr;
        that.data.objectMultiArray = res.data.objectMultiArray;
        that.data.clockname = res.data.time_period;
        that.data.array = res.data.tables;

      },
      fail: function(res) {},
      complete: function(res) {},
    })


  },
  bindNumPickerChange: function(e) {
    // console.log('picker发送选择改变，携带值为', e.detail.value)
    this.setData({
      numIndex: e.detail.value
    })
  },


  bindMultiPickerChange: function(e) {
    // console.log('picker发送选择改变，携带值为', e.detail.value)
    this.setData({
      multiIndex: e.detail.value
    })
  },
  bindMultiPickerColumnChange: function(e) {
    // console.log('修改的列为', e.detail.column, '，值为', e.detail.value);
    //  console.log(e.detail.column)
    var data = {
      multiArray: this.data.multiArray,
      multiIndex: this.data.multiIndex
    };

    data.multiIndex[e.detail.column] = e.detail.value;

    //日期选择

    switch (e.detail.column) {
      case 0:
        // for (i = 0; i < this.data.multiArray[2].length; i++) {

        // }
        switch (data.multiIndex[0]) {

          case 0:
            data.multiArray[1] = this.data.multiArray[1];
            data.multiArray[2] = this.data.multiArray[2];
            break;
          case 1:
            data.multiArray[1] = this.data.multiArray[1];
            data.multiArray[2] = this.data.multiArray[2];
            break;
          case 2:
            data.multiArray[1] = this.data.multiArray[1];
            data.multiArray[2] = this.data.multiArray[2];
            break;
          case 3:
            data.multiArray[1] = this.data.multiArray[1];
            data.multiArray[2] = this.data.multiArray[2];
            break;
          case 4:
            data.multiArray[1] = this.data.multiArray[1];
            data.multiArray[2] = this.data.multiArray[2];
            break;
        }
        data.multiIndex[1] = 0;
        data.multiIndex[2] = 0;
        break;
      case 1:
        switch (data.multiIndex[0]) {
          case 0:
            switch (data.multiIndex[1]) {
              case 0:
                data.multiArray[2] = this.data.clockname[0][0];

                break;
              case 1:
                data.multiArray[2] = this.data.clockname[1][0];
                break;
              case 2:
                data.multiArray[2] = this.data.clockname[2][0];
                break;
              case 3:
                data.multiArray[2] = this.data.clockname[3][0];
                break;
              case 4:
                data.multiArray[2] = this.data.clockname[4][0];
                break;
            }
            break;
        }
        switch (data.multiIndex[1]) {
          case 0:
            data.multiArray[2] = this.data.clockname[0][0];
            break;
          case 1:
            data.multiArray[2] = this.data.clockname[1][0];
            break;
          case 2:
            data.multiArray[2] = this.data.clockname[2][0];
            break;
          case 3:
            data.multiArray[2] = this.data.clockname[3][0];
            break;
          case 4:
            data.multiArray[2] = this.data.clockname[4][0];
            break;
        }
        data.multiIndex[2] = 0;
        break;
    }
    this.setData(data);
  },
  bindPickerChange: function(e) {

    console.log('picker发送选择改变，携带值为', e.target.dataset.id)
    // console.log('picker发送选择改变，携带值为', e.detail.value)
    this.setData({
      index: e.detail.value
    })
  },
  formSubmit: function(e) {
    var that = this;
    if (e.detail.value.assignseat) {
      var taddress = e.detail.value.assignseat;
      var id= e.detail.value.assigin_seatid;
    } else {
      var taddress = e.detail.value.table_id;
      var id=null;
    }

    var domain = getApp().globalData.domain;
    wx: wx.request({
      url: domain + 'Appointment/appoint',
      method: 'GET',
      data: {
        shopid: wx.getStorageSync('shopid'),
        openid: wx.getStorageSync('openid'),
        appointtime: e.detail.value.appointtime,
        table_id: taddress,
        fullname: e.detail.value.fullname,
        mobile: e.detail.value.mobile,
        id:id
      },
      header: {
        'Accept': 'application/json'
      },
      success: function(res) {
        console.log(res)
        if (res.data.status == 1) {
          wx.navigateTo({
            url: './appointdetail?order_num=' + res.data.appointResult.order_num +
              '&order_date=' + res.data.appointResult.appoint_time + '&appoint_detail=' + res.data.appointResult.appoint_detail + '&id=' + res.data.appointResult.id + '&shop_name=' + res.data.appointResult.shop_name
          })
        } else {
          // wx.showToast({
          //   title: res.data.msg,
          //   icon: 'none',
          //   duration: 1500
          // })
        }
      },
      fail: function(res) {},
      complete: function(res) {},
    })
  }
})